<!doctype html>
<html lang="en">

<head>
    <title>SmallRye Mutiny</title>

    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="description" content="SmallRye Mutiny!">

    <link rel="canonical" href="/guides/imperative-to-reactive.html">
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/10.3.1/styles/default.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/semantic-ui/2.4.1/components/icon.min.css" integrity="sha512-8Tb+T7SKUFQWOPIQCaLDWWe1K/SY8hvHl7brOH8Nz5z1VT8fnf8B+9neoUzmFY3OzkWMMs3OjrwZALgB1oXFBg==" crossorigin="anonymous" />
    <link rel="shortcut icon" type="image/png" href="/smallrye-mutiny/assets/images/favicon.ico">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/css/bootstrap.min.css" integrity="sha384-TX8t27EcRE3e/ihU7zmQxVncDAy5uIKz4rEkgIXeMed4M0jlfIDPvg6uqKI2xXr2" crossorigin="anonymous">
    <link rel="stylesheet" href="/smallrye-mutiny/assets/css/main.css" />
    <link rel="stylesheet" href="https://maxst.icons8.com/vue-static/landings/line-awesome/font-awesome-line-awesome/css/all.min.css">
    <link rel="stylesheet" href="https://maxst.icons8.com/vue-static/landings/line-awesome/line-awesome/1.3.0/css/line-awesome.min.css">
</head>

<body>
    <div class="container-fluid global-container">
        





<header class="header masthead mb-auto">
    <div class="container">
        <nav class="navbar navbar-dark navbar-expand-lg">
            <a class="navbar-brand brand mutiny" href="/smallrye-mutiny/index.html"><strong>Mutiny!</strong></a>
            <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#toggler"
                    aria-controls="toggler" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>

            <div class="collapse navbar-collapse" id="toggler">
                <ul class="navbar-nav ml-auto mr-0 mt-2 mt-lg-0">
                    <li class="nav-item"><a class="nav-link " href="/smallrye-mutiny/index.html">Home</a></li>
                    <li class="nav-item"><a class="nav-link " href="/smallrye-mutiny/pages/philosophy">Philosophy</a></li>
                    <li class="nav-item"><a class="nav-link " href="/smallrye-mutiny/getting-started/download">Getting started</a></li>
                    <li class="nav-item"><a class="nav-link active" href="/smallrye-mutiny/guides">Guides</a></li>
                    <li class="nav-item"><a href="https://github.com/smallrye/smallrye-mutiny" target="_blank" title="Github"><i
                            class="lab la-github la-2x"></i></a></li>
                    <li class="nav-item"><a href="https://groups.google.com/d/forum/smallrye" target="_blank" title="SmallRye Google Group"><i
                            class="las la-at la-2x"></i></a></li>
                    <li class="nav-item"><a href="https://stackoverflow.com/questions/tagged/mutiny" target="_blank"
                                            title="Stack Overflow"><i
                            class="lab la-stack-overflow la-2x"></i></a></li>
                </ul>
            </div>
        </nav>
    </div>
</header>
        <main>
            <div class="content">
                

<section class="hero gs">
    <div class="hero-main container">
        <div class="row">
            <div class="hero-left col-12">
                <div class="hero-slogan">
                    <h1 class="hero-name">Imperative to Reactive</h1>
                </div>
                <div class="hero-desc">
                    Learn how to integrate blocking code.
                </div>
                <!-- TODO Labels -->
            </div>
        </div>
    </div>
</section>

<div class="container page-content">
    <div class="row">
        <div class="col-md-9 content">
            <div class="paragraph">
<p>If you use Mutiny, there is a good chance you may want to avoid blocking the caller thread.
In a <em>pure</em> reactive application, the application logic is executed on one of the few I/O threads, and blocking one of these would have dramatic consequences.
So, here is the big question: <em>how to you deal with blocking code?</em></p>
</div>
<div class="paragraph">
<p>Let&#8217;s imagine you have blocking code (e.g., connecting to a database using JDBC, reading a file from the file system&#8230;&#8203;), and you want to integrate that into your reactive pipelines while avoiding blocking.
You would need to isolate such blocking parts of your code and run these parts on worker threads.</p>
</div>
<div class="paragraph">
<p>Mutiny provides two operators to customize the threads used to handle events:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>runSubscriptionOn</code> - to configure the thread used to execute the code happening at subscription-time</p>
</li>
<li>
<p><code>emitOn</code> - to configure the thread used to dispatch events downstream</p>
</li>
</ul>
</div>
<div class="sect1">
<h2 id="running-blocking-code-on-subscription"><a class="anchor" href="#running-blocking-code-on-subscription"></a>Running blocking code on subscription</h2>
<div class="sectionbody">
<div class="paragraph">
<p>It is very usual to deal with the blocking call during the subscription.
In this case, the <code>runSubscription</code> operator is what you need:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">Uni&lt;String&gt; uni = Uni.createFrom()
        .item(this::invokeRemoteServiceUsingBlockingIO)
        .runSubscriptionOn(Infrastructure.getDefaultWorkerPool());</code></pre>
</div>
</div>
<div class="paragraph">
<p>The code above creates a Uni that will supply the item using a blocking call, here the <code>invokeRemoteServiceUsingBlockingIO</code> method.
To avoid blocking the subscriber thread, it uses <code>runSubscriptionOn</code> which switches the thread and call <code>invokeRemoteServiceUsingBlockingIO</code> on another thread.
Here we pass the default worker thread pool, but you can use your own executor.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="title">What&#8217;s that default worker pool?</div>
<div class="paragraph">
<p>In the previous snippet, you may wonder about <code>Infrastructure.getDefaultWorkerPool()</code>.
Mutiny allows the underlying platform to provide a default worker pool.
<code>Infrastructure.getDefaultWorkerPool()</code> provides access to this pool.</p>
</div>
<div class="paragraph">
<p>If the underlying platform does not provide a pool, a default one is used.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Note that <code>runSubscriptionOn</code> does not subscribe to the Uni.
It specifies the executor to use when a subscription happens.</p>
</div>
<div class="paragraph">
<p>While the snippet above uses <code>Uni</code>, you can also use <code>runSubscriptionOn</code> on a <code>Multi</code>.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="executing-blocking-calls-on-event"><a class="anchor" href="#executing-blocking-calls-on-event"></a>Executing blocking calls on event</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Using <code>runSubscriptionOn</code> works when the blocking operation happens at subscription time.
But, when dealing with <code>Multi</code> and need to execute blocking operations for each item, you need to use <code>emitOn</code>.</p>
</div>
<div class="paragraph">
<p>While <code>runSubscriptionOn</code> runs the subscription on the given executor, <code>emitOn</code> configures the executor used to propagate downstream the items, failure and completion events:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">Multi&lt;String&gt; multi = Multi.createFrom().items("john", "jack", "sue")
        .emitOn(Infrastructure.getDefaultWorkerPool())
        .onItem().transform(this::invokeRemoteServiceUsingBlockingIO);</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>emitOn</code> is also available on <code>Uni</code>.</p>
</div>
</div>
</div>
        </div>
        <div class="col-md-3 col-md-offset-1 toc-container d-sm-none d-md-block">
            <nav class="page-toc toc nav sticky-top" id="toc">
                
                <h4>Table of Content</h4>
                <ul class="sectlevel1">
<li><a href="#running-blocking-code-on-subscription">Running blocking code on subscription</a></li>
<li><a href="#executing-blocking-calls-on-event">Executing blocking calls on event</a></li>
</ul>
                

                
                <h4>Related content</h4>
                <ul>
                    
                    <li>
                        
                        <a href="/smallrye-mutiny/guides/reactive-to-imperative">From reactive to imperative</a>
                        
                        
                    </li>
                    
                </ul>
                
            </nav>
        </div>
    </div>
</div>


            </div>
        </main>
        <footer class="footer">
    <div class="container">
        <div class="row">
            <div class="col-lg-9 sep-right">
                <p>
                    SmallRye Mutiny is an open source project. All the code from this project is available under the <a href="https://raw.githubusercontent.com/smallrye/smallrye-mutiny/master/LICENSE">Apache Software License 2.0</a>.
                </p>
                <p>
                    This website was built with <a href="https://jekyllrb.com/">Jekyll</a>, is hosted on Github Pages and is completely open source.
                    You can <a href="https://github.com/smallrye/smallrye-mutiny">fork it</a> and propose enhancements through pull-requests.
                </p>
                <p>
                    Something's wrong? Open an <a href="https://github.com/smallrye/smallrye-mutiny/issues">issue</a>.
                </p>
            </div>
            <div class="col-lg-3">
                <p>
                    Sponsored by
                    <span class="redhat-logo">
                        <a href="https://www.redhat.com/" target="_blank"><img src="/smallrye-mutiny/assets/images/redhat_reversed.svg"></a>
                    </span>
                </p>
                <p>
                    <i class="fab fa-creative-commons"></i><i class="fab fa-creative-commons-by"></i> <a href="https://creativecommons.org/licenses/by/3.0/" target="_blank">CC by 3.0</a>
                    |
                    <a href="https://www.redhat.com/en/about/privacy-policy">Privacy Policy</a>
                </p>
                <p>
                     Site last generated: Feb 18, 2021
                </p>
            </div>
        </div>
    </div>
    <!-- Javascript-->
    <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/10.3.1/highlight.min.js"></script>
    <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js" integrity="sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-ho+j7jyWK8fNQe+A12Hb8AhRq26LrZ/JpcUGGOn+Y7RsweNrtN/tE3MoK7ZeZDyx" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/gh/cferdinandi/gumshoe@4/dist/gumshoe.polyfills.min.js"></script>
    <script src="/smallrye-mutiny/assets/js/hl.js" type="text/javascript"></script>
    <script src="/smallrye-mutiny/assets/js/scrollspy.js" type="text/javascript"></script>

    <script>
        $(document).ready(function(){
            $("#search").on("keyup", function() {
                var value = $(this).val().toLowerCase();
                $(".guide").filter(function() {
                    $(this).toggle($(this).attr("data-search").toLowerCase().indexOf(value) > -1)
                });
            });
        });
    </script>

    <script async src="https://www.googletagmanager.com/gtag/js?id=G-FPQ70JF1EY"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'G-FPQ70JF1EY');
    </script>
</footer>
    </div>
</body>

</html>