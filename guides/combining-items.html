<!doctype html>
<html lang="en">

<head>
    <title>SmallRye Mutiny</title>

    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="description" content="SmallRye Mutiny!">

    <link rel="canonical" href="/guides/combining-items.html">
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/10.3.1/styles/default.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/semantic-ui/2.4.1/components/icon.min.css" integrity="sha512-8Tb+T7SKUFQWOPIQCaLDWWe1K/SY8hvHl7brOH8Nz5z1VT8fnf8B+9neoUzmFY3OzkWMMs3OjrwZALgB1oXFBg==" crossorigin="anonymous" />
    <link rel="shortcut icon" type="image/png" href="/smallrye-mutiny/assets/images/favicon.ico">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/css/bootstrap.min.css" integrity="sha384-TX8t27EcRE3e/ihU7zmQxVncDAy5uIKz4rEkgIXeMed4M0jlfIDPvg6uqKI2xXr2" crossorigin="anonymous">
    <link rel="stylesheet" href="/smallrye-mutiny/assets/css/main.css" />
    <link rel="stylesheet" href="https://maxst.icons8.com/vue-static/landings/line-awesome/font-awesome-line-awesome/css/all.min.css">
    <link rel="stylesheet" href="https://maxst.icons8.com/vue-static/landings/line-awesome/line-awesome/1.3.0/css/line-awesome.min.css">
</head>

<body>
    <div class="container-fluid global-container">
        





<header class="header masthead mb-auto">
    <div class="container">
        <nav class="navbar navbar-dark navbar-expand-lg">
            <a class="navbar-brand brand mutiny" href="/smallrye-mutiny/index.html"><strong>Mutiny!</strong></a>
            <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#toggler"
                    aria-controls="toggler" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>

            <div class="collapse navbar-collapse" id="toggler">
                <ul class="navbar-nav ml-auto mr-0 mt-2 mt-lg-0">
                    <li class="nav-item"><a class="nav-link " href="/smallrye-mutiny/index.html">Home</a></li>
                    <li class="nav-item"><a class="nav-link " href="/smallrye-mutiny/pages/philosophy">Philosophy</a></li>
                    <li class="nav-item"><a class="nav-link " href="/smallrye-mutiny/getting-started/download">Getting started</a></li>
                    <li class="nav-item"><a class="nav-link active" href="/smallrye-mutiny/guides">Guides</a></li>
                    <li class="nav-item"><a href="https://github.com/smallrye/smallrye-mutiny" target="_blank" title="Github"><i
                            class="lab la-github la-2x"></i></a></li>
                    <li class="nav-item"><a href="https://groups.google.com/d/forum/smallrye" target="_blank" title="SmallRye Google Group"><i
                            class="las la-at la-2x"></i></a></li>
                    <li class="nav-item"><a href="https://stackoverflow.com/questions/tagged/mutiny" target="_blank"
                                            title="Stack Overflow"><i
                            class="lab la-stack-overflow la-2x"></i></a></li>
                </ul>
            </div>
        </nav>
    </div>
</header>
        <main>
            <div class="content">
                

<section class="hero gs">
    <div class="hero-main container">
        <div class="row">
            <div class="hero-left col-12">
                <div class="hero-slogan">
                    <h1 class="hero-name">Combining items from streams</h1>
                </div>
                <div class="hero-desc">
                    Learn how to combine items from different streams.
                </div>
                <!-- TODO Labels -->
            </div>
        </div>
    </div>
</section>

<div class="container page-content">
    <div class="row">
        <div class="col-md-9 content">
            <div class="paragraph">
<p>Combining items from various streams is an essential pattern in Reactive Programming.
It associates the emitted items from multiple streams and emits an <em>aggregate</em>.
The downstream receives this <em>aggregates</em> and can handle it smoothly.</p>
</div>
<div class="paragraph">
<p>There are plenty of use cases, such as executing two tasks concurrently and waiting for both completions, getting the last items from different streams to build an always up-to-date view, and so on.</p>
</div>
<div class="sect1">
<h2 id="combining-unis"><a class="anchor" href="#combining-unis"></a>Combining Unis</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Imagine that you have two asynchronous operations to perform like 2 HTTP requests.
You want to send these requests and be notified when both have completed with their responses ready to be consumed.</p>
</div>
<div class="paragraph">
<p>Of course, you could send the first request, wait for the response, and then send the second request.
If both requests are independent, we can do something better: send both concurrently and await for both completions!</p>
</div>
<div class="imageblock reduce">
<div class="content">
<img src="/smallrye-mutiny/assets/images/uni-combine.png" alt="Combining Unis">
</div>
</div>
<div class="paragraph">
<p>How can you achieve this with Mutiny?</p>
</div>
<div class="paragraph">
<p>First, each request is a <code>Uni</code>, so we have:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">Uni&lt;Response&gt; uniA = invokeHttpServiceA();
Uni&lt;Response&gt; uniB = invokeHttpServiceB();</code></pre>
</div>
</div>
<div class="paragraph">
<p>Then, we want to combine both <em>responses</em>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">Uni&lt;Tuple2&lt;Response, Response&gt;&gt; responses = Uni.combine()
        .all().unis(uniA, uniB).asTuple();</code></pre>
</div>
</div>
<div class="paragraph">
<p>This code creates a new <code>Uni</code> produced by combining <code>uniA</code> and <code>uniB</code>.
The responses are aggregated inside a <code>Tuple</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">Uni.combine().all().unis(uniA, uniB).asTuple()
        .subscribe().with(tuple -&gt; {
    System.out.println("Response from A: " + tuple.getItem1());
    System.out.println("Response from B: " + tuple.getItem2());
});</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>tuple</code> aggregates the responses in the same order as the <code>Uni</code> sequence.</p>
</div>
<div class="paragraph">
<p>If one of the <code>Uni</code> fails, so does the combination and you recieve the failure:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">Uni&lt;Response&gt; uniA = invokeHttpServiceA();
Uni&lt;Response&gt; uniB = invokeHttpServiceB();
Uni&lt;Tuple2&lt;Response, Response&gt;&gt; responses = Uni.combine()
        .all().unis(uniA, uniB).asTuple();
Uni.combine().all().unis(uniA, uniB).asTuple()
        .subscribe().with(tuple -&gt; {
    System.out.println("Response from A: " + tuple.getItem1());
    System.out.println("Response from B: " + tuple.getItem2());
});</code></pre>
</div>
</div>
<div class="paragraph">
<p>Using tuples is convenient but only works if you have less than 10 <code>Uni</code> objects.
If you want another structure or deal with more than 10 <code>Uni</code> objects then use <code>combineWith</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">Uni&lt;Map&lt;String, Response&gt;&gt; uni = Uni.combine()
        .all().unis(uniA, uniB).combinedWith(
                listOfResponses -&gt; {
                    Map&lt;String, Response&gt; map = new LinkedHashMap&lt;&gt;();
                    map.put("A", (Response) listOfResponses.get(0));
                    map.put("B", (Response) listOfResponses.get(1));
                    return map;
                }
        );</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="combining-multis"><a class="anchor" href="#combining-multis"></a>Combining Multis</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Combining <code>Multis</code> consists of associating items from different stream per <em>index</em>:</p>
</div>
<div class="imageblock reduce">
<div class="content">
<img src="/smallrye-mutiny/assets/images/multi-combine.png" alt="Combining Multis">
</div>
</div>
<div class="paragraph">
<p>It associates the first items from the combined streams, then the second items:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">Multi&lt;Tuple2&lt;A, B&gt;&gt; combined = Multi.createBy().combining()
        .streams(multiA, multiB).asTuple();</code></pre>
</div>
</div>
<div class="paragraph">
<p>As for <code>Uni</code>, you can aggregate the item into tuples (up to 9 items) or combine with a combinator function:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">Multi.createBy().combining()
        .streams(multiA, multiB).using(list -&gt; combineItems(list))
        .subscribe().with(x -&gt; {
            // do something with the combined items
        });</code></pre>
</div>
</div>
<div class="paragraph">
<p>If one of the streams fails, the combined stream propagates the failure and stops the emission.
The combined stream completes as soon as one of the observed stream sends the completion event.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
If one of the observed streams never emits any item then the combined stream will not emit anything.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="combining-the-last-items-of-multis"><a class="anchor" href="#combining-the-last-items-of-multis"></a>Combining the last items of Multis</h2>
<div class="sectionbody">
<div class="paragraph">
<p>It can be useful to combine multiple <code>Multi</code> streams and receive the <em>latest</em> items from each stream on every emission:</p>
</div>
<div class="imageblock reduce">
<div class="content">
<img src="/smallrye-mutiny/assets/images/multi-combine-latest.png" alt="Combining Multis to always gets the latest items from every stream">
</div>
</div>
<div class="paragraph">
<p>This is achieved using <code>latest()</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">        Multi&lt;Tuple2&lt;A, B&gt;&gt; multi1 = Multi.createBy().combining()
                .streams(multiA, multiB)
                .latestItems().asTuple();

        // or

        Multi&lt;String&gt; multi2 = Multi.createBy().combining()
                .streams(multiA, multiB)
                .latestItems().using(list -&gt; combineItems(list));</code></pre>
</div>
</div>
</div>
</div>
        </div>
        <div class="col-md-3 col-md-offset-1 toc-container d-sm-none d-md-block">
            <nav class="page-toc toc nav sticky-top" id="toc">
                
                <h4>Table of Content</h4>
                <ul class="sectlevel1">
<li><a href="#combining-unis">Combining Unis</a></li>
<li><a href="#combining-multis">Combining Multis</a></li>
<li><a href="#combining-the-last-items-of-multis">Combining the last items of Multis</a></li>
</ul>
                

                
                <h4>Related content</h4>
                <ul>
                    
                    <li>
                        
                        <a href="/smallrye-mutiny/guides/merge-concat">Merging and Concatenating Streams</a>
                        
                        
                    </li>
                    
                </ul>
                
            </nav>
        </div>
    </div>
</div>


            </div>
        </main>
        <footer class="footer">
    <div class="container">
        <div class="row">
            <div class="col-lg-9 sep-right">
                <p>
                    SmallRye Mutiny is an open source project. All the code from this project is available under the <a href="https://raw.githubusercontent.com/smallrye/smallrye-mutiny/master/LICENSE">Apache Software License 2.0</a>.
                </p>
                <p>
                    This website was built with <a href="https://jekyllrb.com/">Jekyll</a>, is hosted on Github Pages and is completely open source.
                    You can <a href="https://github.com/smallrye/smallrye-mutiny">fork it</a> and propose enhancements through pull-requests.
                </p>
                <p>
                    Something's wrong? Open an <a href="https://github.com/smallrye/smallrye-mutiny/issues">issue</a>.
                </p>
            </div>
            <div class="col-lg-3">
                <p>
                    Sponsored by
                    <span class="redhat-logo">
                        <a href="https://www.redhat.com/" target="_blank"><img src="/smallrye-mutiny/assets/images/redhat_reversed.svg"></a>
                    </span>
                </p>
                <p>
                    <i class="fab fa-creative-commons"></i><i class="fab fa-creative-commons-by"></i> <a href="https://creativecommons.org/licenses/by/3.0/" target="_blank">CC by 3.0</a>
                    |
                    <a href="https://www.redhat.com/en/about/privacy-policy">Privacy Policy</a>
                </p>
                <p>
                     Site last generated: Feb 18, 2021
                </p>
            </div>
        </div>
    </div>
    <!-- Javascript-->
    <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/10.3.1/highlight.min.js"></script>
    <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js" integrity="sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-ho+j7jyWK8fNQe+A12Hb8AhRq26LrZ/JpcUGGOn+Y7RsweNrtN/tE3MoK7ZeZDyx" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/gh/cferdinandi/gumshoe@4/dist/gumshoe.polyfills.min.js"></script>
    <script src="/smallrye-mutiny/assets/js/hl.js" type="text/javascript"></script>
    <script src="/smallrye-mutiny/assets/js/scrollspy.js" type="text/javascript"></script>

    <script>
        $(document).ready(function(){
            $("#search").on("keyup", function() {
                var value = $(this).val().toLowerCase();
                $(".guide").filter(function() {
                    $(this).toggle($(this).attr("data-search").toLowerCase().indexOf(value) > -1)
                });
            });
        });
    </script>

    <script async src="https://www.googletagmanager.com/gtag/js?id=G-FPQ70JF1EY"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'G-FPQ70JF1EY');
    </script>
</footer>
    </div>
</body>

</html>